<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸å­—æ‰¾æ‰¾çœ‹ - é„­å‡±æ–‡è¨­è¨ˆç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --accent: #f472b6;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1e293b;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* åˆå§‹ç•«é¢æ¨¡å¼ */
        .scroll-mode { overflow-y: auto; display: block; padding: 2rem 1rem; }
        /* éŠæˆ²ä¸­æ¨¡å¼ï¼šåš´æ ¼ç¦æ­¢æ²å‹• */
        .no-scroll-mode { overflow: hidden; height: 100vh; width: 100vw; display: flex; flex-direction: column; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.3);
        }

        .number-card {
            aspect-ratio: 1 / 1;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            line-height: 1;
        }

        .number-card.selected {
            background: var(--primary) !important;
            color: white !important;
            border-color: transparent !important;
            transform: scale(1.05);
            z-index: 10;
        }

        .number-card.correct {
            background: #10b981 !important;
            color: white !important;
            border-color: transparent !important;
            animation: celebrate 0.5s ease;
        }

        .number-card.wrong {
            background: #f43f5e !important;
            color: white !important;
            border-color: transparent !important;
            animation: shake 0.4s ease-in-out;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .custom-input { border: 2px solid #e2e8f0; transition: all 0.2s; }
        .custom-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        #grid-area {
            flex: 1;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 0.5rem;
        }

        #grid {
            display: grid;
            width: fit-content;
            height: fit-content;
            margin: auto;
        }

        .stat-card {
            background: white;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            border: 1px solid #f1f5f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="scroll-mode">

    <!-- èƒŒæ™¯è£é£¾ -->
    <div class="fixed top-[-5%] left-[-5%] w-72 h-72 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 pointer-events-none"></div>
    <div class="fixed bottom-[-5%] right-[-5%] w-96 h-96 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 pointer-events-none"></div>

    <!-- åˆå§‹è¨­å®šç•«é¢ -->
    <div id="setup-screen" class="glass-panel p-8 rounded-[2.5rem] max-w-lg w-full z-10 mx-auto my-auto">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-black text-gray-800 tracking-tight mb-2">æ•¸å­—å°å°ç¢°</h1>
            <p class="text-gray-400 font-bold uppercase tracking-widest text-xs">Visual Focus Challenge</p>
        </div>
        
        <div class="space-y-6">
            <!-- åƒæ•¸è¼¸å…¥å€ (ç§»é™¤æ‹‰æ¡¿ï¼Œæ”¹ç‚ºå¤§è¼¸å…¥æ¡†ä»¥åˆ©æ‰‹æ©Ÿæ“ä½œ) -->
            <div class="grid grid-cols-2 gap-4">
                <div class="space-y-2 bg-white/50 p-4 rounded-2xl border border-white/50">
                    <label class="text-xs font-black text-indigo-600 uppercase tracking-wider block">ç¸½é¡Œç›®æ•¸</label>
                    <input type="number" id="total-rounds-input" value="10" min="1" max="99" class="custom-input w-full text-center py-3 rounded-xl font-black text-2xl text-gray-800 outline-none">
                </div>
                <div class="space-y-2 bg-white/50 p-4 rounded-2xl border border-white/50">
                    <label class="text-xs font-black text-indigo-600 uppercase tracking-wider block">å–®é¡Œæ•¸é‡</label>
                    <input type="number" id="item-count-input" value="10" min="4" max="100" class="custom-input w-full text-center py-3 rounded-xl font-black text-2xl text-gray-800 outline-none">
                </div>
            </div>

            <div class="bg-white/50 p-4 rounded-2xl space-y-4 border border-white/50">
                <label class="text-xs font-black text-indigo-600 uppercase tracking-wider block text-center">æ•¸å­—ç¯„åœè¨­å®š (0-999)</label>
                <div class="grid grid-cols-2 gap-4">
                    <div class="flex flex-col gap-1">
                        <span class="text-[10px] text-gray-400 font-bold ml-1 uppercase">å¾ (Min)</span>
                        <input type="number" id="min-range" value="1" min="0" max="999" class="w-full bg-white rounded-xl px-4 py-3 outline-none custom-input font-black text-xl text-center">
                    </div>
                    <div class="flex flex-col gap-1">
                        <span class="text-[10px] text-gray-400 font-bold ml-1 uppercase">åˆ° (Max)</span>
                        <input type="number" id="max-range" value="30" min="1" max="999" class="w-full bg-white rounded-xl px-4 py-3 outline-none custom-input font-black text-xl text-center">
                    </div>
                </div>
                <p id="range-error" class="text-red-500 text-xs text-center hidden font-black bg-red-50 py-2 rounded-xl border border-red-100 italic">âš ï¸ ç¯„åœä¸è¶³ï¼šå€é–“å¿…é ˆå¤§æ–¼å–®é¡Œæ•¸é‡ï¼</p>
                <p id="limit-error" class="text-orange-500 text-[10px] text-center hidden font-black italic">âš ï¸ æé†’ï¼šæœ€å¤§ç¯„åœä¸Šé™ç‚º 999ã€‚</p>
            </div>

            <div class="bg-white/50 p-4 rounded-2xl space-y-3 border border-white/50">
                <div class="flex justify-between items-center">
                    <label class="text-xs font-black text-indigo-600 uppercase tracking-wider">å–®é¡Œé™æ™‚ (ç§’)</label>
                    <input type="number" id="game-time" min="3" max="120" value="30" class="custom-input w-20 text-center py-1 rounded-lg font-bold text-indigo-600 outline-none">
                </div>
                <input type="range" id="game-time-slider" min="3" max="120" step="1" value="30" class="w-full">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button id="start-btn" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-black py-4 rounded-2xl text-lg transition-all shadow-xl active:scale-95 hover:brightness-110 disabled:grayscale disabled:opacity-50 disabled:cursor-not-allowed">
                    é–‹å§‹æŒ‘æˆ°
                </button>
                <button id="view-history-btn" class="bg-white/80 text-gray-600 font-black py-4 rounded-2xl text-lg border border-gray-100 shadow-sm flex items-center justify-center gap-2">
                    ğŸ“œ ç´€éŒ„
                </button>
            </div>

            <div class="text-center pt-4 border-t border-gray-100">
                <a href="https://www.facebook.com/mpotkevin" target="_blank" class="text-gray-400 font-bold text-sm hover:text-indigo-600">
                    è¨­è¨ˆï¼šè·èƒ½æ²»ç™‚å¸« - é„­å‡±æ–‡
                </a>
            </div>
        </div>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ -->
    <div id="game-screen" class="hidden fixed inset-0 z-10 p-2 md:p-4 flex flex-col">
        <div class="w-full max-w-5xl mx-auto glass-panel rounded-2xl px-4 py-2 flex items-center justify-between gap-4 shrink-0 mb-1">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 text-white w-8 h-8 rounded-lg flex items-center justify-center font-black" id="round-num">1</div>
                <span id="round-indicator" class="text-base font-black text-gray-800">1 / 10</span>
            </div>
            <div class="flex-1 max-w-md h-1.5 bg-gray-100 rounded-full overflow-hidden">
                <div id="progress-fill" class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 w-full transition-all"></div>
            </div>
            <div id="timer-text" class="text-xl font-black font-mono text-indigo-600 w-20 text-right">30.0s</div>
        </div>

        <div id="grid-area">
            <div id="grid"></div>
        </div>

        <div class="flex justify-center pb-2 shrink-0">
            <button id="abort-btn" class="px-6 py-1.5 bg-white/40 text-indigo-900 font-black rounded-full backdrop-blur-md border border-white/20 active:scale-95 text-xs shadow-sm">
                ä¸­æ­¢æŒ‘æˆ°
            </button>
        </div>
    </div>

    <!-- çµç®—ç•«é¢ (è©³ç´°æˆç¸¾) -->
    <div id="result-screen" class="hidden glass-panel p-6 rounded-[2.5rem] max-w-md w-full text-center z-20 mx-auto my-auto shadow-2xl">
        <div id="result-icon" class="text-6xl mb-4 drop-shadow-lg">ğŸ†</div>
        <h2 id="result-title" class="text-3xl font-black text-gray-800 mb-6">æŒ‘æˆ°çµæŸï¼</h2>
        
        <div class="grid grid-cols-2 gap-3 mb-8">
            <div class="stat-card">
                <span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">æ­£ç¢ºé¡Œæ•¸</span>
                <span id="stat-correct-val" class="text-2xl font-black text-green-500">0</span>
            </div>
            <div class="stat-card">
                <span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">éŒ¯èª¤é¡Œæ•¸</span>
                <span id="stat-wrong-val" class="text-2xl font-black text-red-500">0</span>
            </div>
            <div class="stat-card">
                <span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">å¹³å‡ç”¨æ™‚</span>
                <span id="stat-avg-val" class="text-2xl font-black text-indigo-600">0.0s</span>
            </div>
            <div class="stat-card">
                <span class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">ç¸½è¨ˆè€—æ™‚</span>
                <span id="stat-total-val" class="text-2xl font-black text-indigo-400">0.0s</span>
            </div>
        </div>

        <div class="space-y-3">
            <button id="retry-btn" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-black py-4 rounded-2xl text-xl shadow-xl active:scale-95 transition-all">
                å†æ¬¡æŒ‘æˆ°
            </button>
            <button id="back-btn" class="w-full text-gray-400 font-black py-2 hover:text-gray-600">
                è¿”å›ä¸»ç•«é¢
            </button>
        </div>
    </div>

    <!-- æ­·å²ç´€éŒ„å½ˆçª— -->
    <div id="history-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm">
        <div class="glass-panel w-full max-w-md rounded-[2.5rem] p-8 max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-black text-gray-800">æ­·å²æˆç¸¾</h3>
                <button id="close-history-btn" class="text-3xl text-gray-400">&times;</button>
            </div>
            <div id="history-list" class="flex-1 overflow-y-auto space-y-3"></div>
            <button id="clear-history-btn" class="mt-6 text-xs text-red-400 font-bold uppercase tracking-widest text-center">æ¸…ç©ºç´€éŒ„</button>
        </div>
    </div>

    <!-- ä¸­æ­¢ç¢ºèªå½ˆçª— -->
    <div id="abort-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/40 backdrop-blur-md">
        <div class="glass-panel w-full max-w-xs rounded-[2rem] p-8 text-center">
            <div class="text-5xl mb-4">ğŸ›‘</div>
            <h3 class="text-xl font-black text-gray-800 mb-6">è¦ä¸­æ­¢æŒ‘æˆ°å—ï¼Ÿ</h3>
            <div class="grid grid-cols-2 gap-3">
                <button id="confirm-abort-btn" class="bg-red-500 text-white font-black py-3 rounded-xl">ä¸­æ­¢</button>
                <button id="cancel-abort-btn" class="bg-gray-100 text-gray-600 font-black py-3 rounded-xl">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ ¸å¿ƒç‹€æ…‹
        let state = {
            config: { totalRounds: 10, itemCount: 10, minNum: 1, maxNum: 30, timeLimit: 30 },
            current: { round: 0, correctCount: 0, roundTimes: [], remainingTime: 0, targetPair: null, selectedId: null, isGameOver: false, timerInterval: null },
            history: JSON.parse(localStorage.getItem('num_match_history_v6') || '[]')
        };

        // DOM å…ƒç´ é¸å–
        const els = {
            totalInp: document.getElementById('total-rounds-input'),
            countInp: document.getElementById('item-count-input'),
            minRange: document.getElementById('min-range'),
            maxRange: document.getElementById('max-range'),
            gameTime: document.getElementById('game-time'),
            gameTimeSld: document.getElementById('game-time-slider'),
            timeDisp: document.getElementById('time-display'),
            grid: document.getElementById('grid'),
            gridArea: document.getElementById('grid-area'),
            progress: document.getElementById('progress-fill'),
            timer: document.getElementById('timer-text'),
            rangeError: document.getElementById('range-error'),
            limitError: document.getElementById('limit-error'),
            startBtn: document.getElementById('start-btn')
        };

        const screens = { 
            setup: document.getElementById('setup-screen'), 
            game: document.getElementById('game-screen'), 
            result: document.getElementById('result-screen') 
        };

        // åƒæ•¸é©—è­‰é‚è¼¯
        function validate() {
            let total = parseInt(els.totalInp.value) || 1;
            let count = parseInt(els.countInp.value) || 4;
            let min = parseInt(els.minRange.value) || 0;
            let max = parseInt(els.maxRange.value) || 0;

            let limitExceeded = false;
            if (min >= 1000) { min = 999; els.minRange.value = 999; limitExceeded = true; }
            if (max >= 1000) { max = 999; els.maxRange.value = 999; limitExceeded = true; }
            if (min < 0) { min = 0; els.minRange.value = 0; }
            if (max < 1) { max = 1; els.maxRange.value = 1; }

            state.config.totalRounds = total;
            state.config.itemCount = count;
            state.config.minNum = min;
            state.config.maxNum = max;
            
            const rangeSize = max - min + 1;
            const isValid = rangeSize >= count;
            
            els.rangeError.classList.toggle('hidden', isValid);
            els.limitError.classList.toggle('hidden', !limitExceeded);
            els.startBtn.disabled = !isValid;
            return isValid;
        }

        // æ™‚é–“æ‹‰æ¡¿åŒæ­¥
        els.gameTime.oninput = (e) => { 
            let v = parseInt(e.target.value) || 3;
            v = Math.max(3, Math.min(120, v));
            els.gameTimeSld.value = v;
            state.config.timeLimit = v;
        };
        els.gameTimeSld.oninput = (e) => {
            els.gameTime.value = e.target.value;
            state.config.timeLimit = parseInt(e.target.value);
        };

        els.totalInp.oninput = validate;
        els.countInp.oninput = validate;
        els.minRange.oninput = validate;
        els.maxRange.oninput = validate;

        function showScreen(key) {
            Object.keys(screens).forEach(k => {
                if (screens[k]) screens[k].classList.toggle('hidden', k !== key);
            });
            document.body.className = (key === 'game') ? 'no-scroll-mode' : 'scroll-mode';
        }

        function start() {
            if (!validate()) return;
            state.current.correctCount = 0; 
            state.current.roundTimes = []; 
            state.current.round = 0;
            showScreen('game'); 
            next();
        }

        function next() {
            state.current.round++;
            state.current.selectedId = null;
            state.current.isGameOver = false;
            state.current.remainingTime = state.config.timeLimit;
            
            document.getElementById('round-num').innerText = state.current.round;
            document.getElementById('round-indicator').innerText = `${state.current.round} / ${state.config.totalRounds}`;
            
            setupGrid(); 
            startTimer();
        }

        function setupGrid() {
            els.grid.innerHTML = '';
            let n = state.config.itemCount;
            const areaW = els.gridArea.clientWidth;
            const areaH = els.gridArea.clientHeight;
            const gap = n > 50 ? 4 : 8;

            const actualRangeSize = state.config.maxNum - state.config.minNum + 1;
            if (n > actualRangeSize) n = actualRangeSize;

            let bestSize = 0;
            let bestCols = 0;

            for (let c = 1; c <= n; c++) {
                let r = Math.ceil(n / c);
                let sizeW = (areaW - (c + 1) * gap) / c;
                let sizeH = (areaH - (r + 1) * gap) / r;
                let S = Math.min(sizeW, sizeH);
                if (S > bestSize) { bestSize = S; bestCols = c; }
            }

            els.grid.style.gridTemplateColumns = `repeat(${bestCols}, ${bestSize}px)`;
            els.grid.style.gap = `${gap}px`;
            const fontSize = Math.floor(bestSize * 0.45);
            
            const target = Math.floor(Math.random() * actualRangeSize) + state.config.minNum;
            state.current.targetPair = target;

            const pool = new Set([target]);
            let attempts = 0;
            while(pool.size < n - 1 && attempts < 2000) {
                pool.add(Math.floor(Math.random() * actualRangeSize) + state.config.minNum);
                attempts++;
            }
            
            const nums = Array.from(pool); nums.push(target);
            nums.sort(() => Math.random() - 0.5);

            nums.forEach((num, i) => {
                const card = document.createElement('div');
                card.className = `number-card bg-white border-2 border-gray-100 rounded-xl shadow-sm text-gray-700 cursor-pointer`;
                card.style.width = `${bestSize}px`;
                card.style.height = `${bestSize}px`;
                card.style.fontSize = `${fontSize}px`;
                card.innerText = num;
                card.dataset.val = num;
                card.dataset.idx = i;
                card.onclick = () => click(card);
                els.grid.appendChild(card);
            });
        }

        function click(card) {
            if (state.current.isGameOver) return;
            const val = parseInt(card.dataset.val);
            const idx = card.dataset.idx;
            if (state.current.selectedId === idx) { card.classList.remove('selected'); state.current.selectedId = null; return; }
            if (state.current.selectedId === null) {
                state.current.selectedId = idx; card.classList.add('selected');
            } else {
                const prev = document.querySelector(`[data-idx="${state.current.selectedId}"]`);
                if (val === parseInt(prev.dataset.val)) {
                    card.classList.add('correct'); prev.classList.replace('selected', 'correct');
                    state.current.roundTimes.push(state.config.timeLimit - state.current.remainingTime);
                    state.current.correctCount++;
                    finish(true);
                } else {
                    card.classList.add('wrong'); prev.classList.add('wrong');
                    setTimeout(() => { card.classList.remove('wrong', 'selected'); prev.classList.remove('wrong', 'selected'); }, 400);
                    state.current.selectedId = null;
                }
            }
        }

        function startTimer() {
            if(state.current.timerInterval) clearInterval(state.current.timerInterval);
            const startT = Date.now();
            const endT = startT + (state.config.timeLimit * 1000);
            state.current.timerInterval = setInterval(() => {
                const diff = Math.max(0, (endT - Date.now()) / 1000);
                state.current.remainingTime = diff;
                els.progress.style.width = `${(diff / state.config.timeLimit) * 100}%`;
                els.timer.innerText = `${diff.toFixed(1)}s`;
                if(diff <= 0) { state.current.roundTimes.push(state.config.timeLimit); finish(false); }
            }, 50);
        }

        function finish(win) {
            state.current.isGameOver = true;
            clearInterval(state.current.timerInterval);
            if(!win) {
                document.querySelectorAll('.number-card').forEach(c => {
                    if(parseInt(c.dataset.val) === state.current.targetPair) c.classList.add('ring-4', 'ring-green-400', 'z-20');
                });
            }
            setTimeout(() => {
                if(state.current.round < state.config.totalRounds) next();
                else result();
            }, win ? 600 : 2000);
        }

        function result() {
            showScreen('result');
            const totalTime = state.current.roundTimes.reduce((a,b)=>a+b, 0);
            const totalRounds = state.config.totalRounds;
            const correct = state.current.correctCount;
            const wrong = totalRounds - correct;
            const avgTime = (totalTime / totalRounds).toFixed(1);

            document.getElementById('stat-correct-val').innerText = correct;
            document.getElementById('stat-wrong-val').innerText = wrong;
            document.getElementById('stat-avg-val').innerText = `${avgTime}s`;
            document.getElementById('stat-total-val').innerText = `${totalTime.toFixed(1)}s`;
            
            const record = {
                date: new Date().toLocaleString([], {month:'numeric', day:'numeric', hour:'2-digit', minute:'2-digit'}),
                score: correct, 
                total: totalRounds, 
                avgTime: avgTime
            };
            state.history.unshift(record);
            state.history = state.history.slice(0, 10);
            localStorage.setItem('num_match_history_v6', JSON.stringify(state.history));
            
            // æ ¹æ“šè¡¨ç¾é¡¯ç¤ºæ¨™é¡Œèˆ‡åœ–ç¤º
            const resultIcon = document.getElementById('result-icon');
            const resultTitle = document.getElementById('result-title');
            if (correct === totalRounds) { resultIcon.innerText = "ğŸ†"; resultTitle.innerText = "å®Œç¾çš„å‹åˆ©ï¼"; }
            else if (correct >= totalRounds * 0.7) { resultIcon.innerText = "ğŸŒŸ"; resultTitle.innerText = "è¡¨ç¾å¾ˆå„ªç•°ï¼"; }
            else { resultIcon.innerText = "ğŸ’ª"; resultTitle.innerText = "ç¹¼çºŒåŠ æ²¹ï¼"; }
        }

        // åˆå§‹åŒ–
        window.onload = () => {
            els.startBtn.onclick = start;
            document.getElementById('retry-btn').onclick = start;
            document.getElementById('back-btn').onclick = () => showScreen('setup');

            document.getElementById('view-history-btn').onclick = () => {
                const list = document.getElementById('history-list');
                list.innerHTML = state.history.length ? '' : '<p class="text-center py-10 text-gray-400">ç›®å‰ç„¡ç´€éŒ„</p>';
                state.history.forEach(h => {
                    const d = document.createElement('div');
                    d.className = 'bg-white/60 p-4 rounded-xl flex justify-between items-center border border-white/50 text-sm';
                    d.innerHTML = `<div><div class="text-[10px] font-black text-gray-400">${h.date}</div><div class="font-black">æ­£ç¢º ${h.score}/${h.total}</div></div><div class="text-indigo-600 font-black">${h.avgTime}s/é¡Œ</div>`;
                    list.appendChild(d);
                });
                document.getElementById('history-modal').classList.remove('hidden');
            };

            document.getElementById('close-history-btn').onclick = () => document.getElementById('history-modal').classList.add('hidden');
            document.getElementById('clear-history-btn').onclick = () => { 
                state.history = []; 
                localStorage.removeItem('num_match_history_v6'); 
                document.getElementById('history-modal').classList.add('hidden'); 
            };

            const abortM = document.getElementById('abort-modal');
            document.getElementById('abort-btn').onclick = () => abortM.classList.remove('hidden');
            document.getElementById('cancel-abort-btn').onclick = () => abortM.classList.add('hidden');
            document.getElementById('confirm-abort-btn').onclick = () => { 
                clearInterval(state.current.timerInterval); 
                abortM.classList.add('hidden'); 
                showScreen('setup'); 
            };

            window.addEventListener('resize', () => { 
                if (!screens.game.classList.contains('hidden')) setupGrid(); 
            });

            validate();
        };
    </script>
</body>
</html>
